# 部署指南

## 🚀 快速部署

### 1. 本地构建

```bash
# 构建生产版本
pnpm build

# 构建完成后，所有文件在 frontend/dist/ 目录
```

### 2. 本地预览

```bash
# 方法1: 直接打开
# 用浏览器打开 frontend/dist/index.html

# 方法2: 使用Python HTTP服务器
cd frontend/dist
python3 -m http.server 8080
# 访问 http://localhost:8080

# 方法3: 使用npx serve
npx serve frontend/dist
```

## 🌐 部署到云平台

### GitHub Pages（免费）

#### 自动部署
```bash
# 1. 确保你的项目已推送到GitHub
git add .
git commit -m "准备部署"
git push origin main

# 2. 构建并部署
pnpm deploy
```

#### 手动部署
```bash
# 1. 构建
pnpm build

# 2. 创建gh-pages分支并推送
cd frontend/dist
git init
git add -A
git commit -m 'deploy'
git branch -M gh-pages
git remote add origin https://github.com/你的用户名/你的仓库名.git
git push -f origin gh-pages

# 3. 在GitHub仓库设置中启用Pages
# Settings -> Pages -> Source: gh-pages branch
```

访问地址：`https://你的用户名.github.io/你的仓库名/`

### Netlify（免费，推荐）

#### 拖拽部署（最简单）
1. 访问 [Netlify](https://www.netlify.com/)
2. 注册/登录
3. 拖拽 `frontend/dist/` 文件夹到 Netlify
4. 获得 `your-site.netlify.app` 域名

#### 持续部署
1. 连接GitHub仓库
2. 构建设置：
   - **Base directory**: `frontend`
   - **Build command**: `pnpm build`
   - **Publish directory**: `frontend/dist`
3. 每次推送代码自动部署

### Vercel（免费）

#### CLI部署
```bash
# 1. 安装Vercel CLI
npm i -g vercel

# 2. 登录
vercel login

# 3. 部署
cd /srv/projects/yywxd/frontend
vercel --prod
```

#### Git部署
1. 连接GitHub仓库
2. 项目设置：
   - **Framework Preset**: Vite
   - **Root Directory**: `frontend`
   - **Build Command**: `pnpm build`
   - **Output Directory**: `dist`

### Cloudflare Pages（免费）

1. 连接GitHub仓库
2. 构建配置：
   - **Framework preset**: Vite
   - **Build command**: `pnpm build`
   - **Build output directory**: `frontend/dist`
   - **Root directory**: `frontend`

## 📱 自定义域名

### GitHub Pages
在仓库根目录创建 `CNAME` 文件：
```
your-domain.com
```

### Netlify/Vercel/Cloudflare
在平台设置中添加自定义域名，按照提示配置DNS记录。

## 🔧 构建优化

### 减小文件大小

编辑 `frontend/vite.config.ts`：
```typescript
export default defineConfig({
  // ... 现有配置
  build: {
    outDir: 'dist',
    minify: 'terser',
    terserOptions: {
      compress: {
        drop_console: true, // 移除console.log
      }
    },
    rollupOptions: {
      output: {
        manualChunks: {
          'quasar': ['quasar'],
          'vue': ['vue', 'vue-router']
        }
      }
    }
  }
})
```

### 启用Gzip压缩

大多数托管平台自动启用，无需配置。

## 📊 性能优化建议

1. **启用CDN** - Netlify/Vercel/Cloudflare自动提供
2. **缓存策略** - 静态资源默认缓存1年
3. **图片优化** - 如果添加图片，使用WebP格式
4. **懒加载** - 已通过Vue Router实现

## 🔍 SEO优化（可选）

编辑 `frontend/index.html`：
```html
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="业余无线电C类考试记忆助手 - 1283道题目，32条记忆口诀">
  <meta name="keywords" content="业余无线电,HAM,C类考试,记忆口诀,题库">
  <title>业余无线电C类考试记忆助手</title>
</head>
```

## 🐛 常见问题

### Q: 部署后页面空白？
A: 检查 `vite.config.ts` 中 `base` 配置是否为 `'./'`

### Q: CSV文件404？
A: 确保 `C类题库_extracted.csv` 在 `frontend/public/` 目录

### Q: 路由404错误？
A: 在托管平台配置重定向规则：
- Netlify: 创建 `public/_redirects` 文件，内容 `/* /index.html 200`
- Vercel: 自动处理

### Q: 如何更新题库？
A: 替换 `frontend/public/C类题库_extracted.csv`，重新构建部署

## 📦 CI/CD自动部署

### GitHub Actions示例

创建 `.github/workflows/deploy.yml`：
```yaml
name: Deploy to GitHub Pages

on:
  push:
    branches: [main]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - uses: pnpm/action-setup@v2
        with:
          version: 8

      - uses: actions/setup-node@v3
        with:
          node-version: 18
          cache: 'pnpm'

      - run: pnpm install
      - run: pnpm build

      - uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./frontend/dist
```

## 🎉 部署检查清单

- [ ] 运行 `pnpm build` 成功
- [ ] 本地预览 `dist/index.html` 正常
- [ ] CSV文件可以正常加载
- [ ] 所有页面路由正常
- [ ] 记忆口诀显示正常
- [ ] 移动端显示正常
- [ ] 选择托管平台
- [ ] 上传或连接仓库
- [ ] 验证部署成功
- [ ] 测试生产环境

完成后你就有一个可以分享给其他无线电爱好者的学习工具了！🎓
